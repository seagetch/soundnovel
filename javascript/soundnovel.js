/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./src/main/soundnovel.ts");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./src/main/scenario/scenario.ts":
/*!***************************************!*\
  !*** ./src/main/scenario/scenario.ts ***!
  \***************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar glob = __webpack_require__(/*! glob */ \"glob\");\nvar path = __webpack_require__(/*! path */ \"path\");\nvar scenario;\n(function (scenario_1) {\n    var Command = (function () {\n        function Command() {\n            this._command = null;\n        }\n        Object.defineProperty(Command.prototype, \"command\", {\n            get: function () { return this._command; },\n            set: function (val) { this._command = val; },\n            enumerable: true,\n            configurable: true\n        });\n        return Command;\n    }());\n    scenario_1.Command = Command;\n    var Scene = (function (_super) {\n        __extends(Scene, _super);\n        function Scene(sound, image) {\n            var _this = _super.call(this) || this;\n            _this.command = \"scene\";\n            _this._sound = sound;\n            _this._image = image;\n            return _this;\n        }\n        Object.defineProperty(Scene.prototype, \"sound\", {\n            get: function () { return this._sound; },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(Scene.prototype, \"image\", {\n            get: function () { return this._image; },\n            enumerable: true,\n            configurable: true\n        });\n        return Scene;\n    }(Command));\n    scenario_1.Scene = Scene;\n    var Ask = (function (_super) {\n        __extends(Ask, _super);\n        function Ask(options) {\n            var _this = _super.call(this) || this;\n            _this._options = options;\n            return _this;\n        }\n        Object.defineProperty(Ask.prototype, \"options\", {\n            get: function () { return this._options; },\n            enumerable: true,\n            configurable: true\n        });\n        return Ask;\n    }(Command));\n    scenario_1.Ask = Ask;\n    var Scenario = (function () {\n        function Scenario(root_path, config) {\n            this.root_path = root_path;\n            this._config = config;\n            this.situation_change = 50;\n            this.music_path = root_path + \"/\" + this._config[\"paths\"].Music;\n            this.image_path = root_path + \"/\" + this._config[\"paths\"].Images;\n            this.sub_scenario = [];\n            this._variables = {};\n        }\n        Object.defineProperty(Scenario.prototype, \"config\", {\n            get: function () { return this._config; },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(Scenario.prototype, \"variables\", {\n            get: function () { return this._variables; },\n            enumerable: true,\n            configurable: true\n        });\n        Scenario.prototype.get_prefix_for = function (name) {\n            if (this.sub_scenario != null) {\n                var state = this.sub_scenario[this.sub_scenario.length - 1][name];\n                return state[1];\n            }\n            return null;\n        };\n        Scenario.prototype.list_files = function (name, prefix, candidates) {\n            if (prefix === void 0) { prefix = null; }\n            if (candidates === void 0) { candidates = null; }\n            if (!prefix)\n                prefix = this.get_prefix_for(name);\n            var result = glob.sync(path.join(this.music_path, prefix));\n            result.sort();\n            if (candidates)\n                result = result.filter(function (s) { return prefix.indexOf(path.basename(s)) >= 0; });\n            return [result, this._config[\"image_map\"][prefix]];\n        };\n        Scenario.prototype.get_image_path = function (images, id) {\n            var _this = this;\n            var name = images[id % images.length];\n            if (name instanceof Array) {\n                return [name[0]].concat(name.slice(1, name.length).map(function (x) {\n                    if (typeof (x) == \"string\")\n                        return path.join(_this.image_path, x);\n                    else\n                        return x;\n                }));\n            }\n            else if (typeof (name) == \"string\")\n                return path.join(this.image_path, name);\n        };\n        Scenario.prototype.select_action_rand = function (name, prefix) {\n            var resources = this.list_files(name, prefix);\n            var sounds = resources[0];\n            var images = resources[1];\n            if (sounds instanceof Array) {\n                var selected = Math.floor(Math.random() * sounds.length);\n                return [selected, [sounds[selected], this.get_image_path(images, selected)]];\n            }\n            return [null, [null, null]];\n        };\n        Scenario.prototype.dice = function (current, mapping) {\n            var judge = null;\n            while (!judge) {\n                var dice_ = Math.random() * 100;\n                console.log(\"DICE=\" + dice_);\n                var index = 0;\n                for (var _i = 0, mapping_1 = mapping; _i < mapping_1.length; _i++) {\n                    var m = mapping_1[_i];\n                    var v = m[0];\n                    var k = m[1];\n                    if (dice_ < v) {\n                        if (this.histories.length > 1 &&\n                            this.histories[this.histories.length - 1].length > 1 &&\n                            this.histories[this.histories.length - 1][this.histories[this.histories.length - 1].length - 1] == k[1])\n                            break;\n                        else {\n                            judge = k;\n                            console.log(\"ACT=\" + judge[0] + \"->\" + judge[1]);\n                            break;\n                        }\n                    }\n                    dice_ -= v;\n                    index++;\n                }\n                if (judge) {\n                    if (judge.length > 2) {\n                        var prefix = judge.slice(2, judge.length);\n                        var resources = this.list_files(current);\n                        var sound_candidates = resources[0], images = resources[1];\n                        var variation = Math.floor(Math.random() * sound_candidates.length);\n                        var resources2 = [[sound_candidates[variation], this.get_image_path(images, index)]];\n                        judge = judge.slice(0, 2).concat(resources2);\n                    }\n                    return judge;\n                }\n            }\n        };\n        Scenario.prototype.transit_to_next = function (next_info) {\n            var current = (this.states.length > 0) ? this.states[this.states.length - 1] : null;\n            switch (next_info[0]) {\n                case Scenario.Dice:\n                    {\n                        console.log(\"Dice\");\n                        var file_prefix = (next_info.length > 2) ? next_info.slice(2, next_info.length) : null;\n                        next_info = this.dice(current, this._config[next_info[1]]);\n                    }\n                    break;\n                case Scenario.DiceWithMode:\n                    {\n                        console.log(\"Dice-with-mode\");\n                        next_info = this.dice(current, this._config[next_info[1]][this._variables[\"mode\"]]);\n                    }\n                    break;\n                case Scenario.DiceWith:\n                    {\n                        var value = this._variables[next_info[1]];\n                        console.log(\"Dice-with\");\n                        next_info = this.dice(current, this._config[next_info[2]][value]);\n                    }\n                    break;\n            }\n            ;\n            switch (next_info[0]) {\n                case Scenario.Jump:\n                    {\n                        console.log(\"Jump [\" + this.states.length + \"] --> \" + next_info[1]);\n                        if (this.states.length > 0) {\n                            this.states[this.states.length - 1] = next_info[1];\n                            this.histories[this.histories.length - 1].push(next_info[1]);\n                        }\n                    }\n                    break;\n                case Scenario.JumpBy:\n                    {\n                        var value = this._variables[next_info[1]];\n                        var next_name = (next_info.length >= 3) ? next_info[2][value] : value;\n                        console.log(\"Jump by [\" + next_info[1] + \"=\" + value + \"] --> \" + next_name);\n                        if (this.states.length > 0) {\n                            this.states[this.states.length - 1] = next_name;\n                            this.histories[this.histories.length - 1].push(next_name);\n                        }\n                        next_info = [];\n                    }\n                    break;\n                case Scenario.Exit:\n                    {\n                        if (this.sub_scenario.length) {\n                            this.sub_scenario.pop();\n                            this.states.pop();\n                            this.histories.pop();\n                        }\n                        var next_name = (next_info.length >= 2) ? next_info[1] : null;\n                        console.log(\"Exit [\" + this.states.length + \"]\");\n                        if (this.states.length > 0) {\n                            this.states[this.states.length - 1] = next_name;\n                            this.histories[this.histories.length - 1].push(next_name);\n                        }\n                    }\n                    break;\n                default:\n                    console.log(\"Unknown action '\" + next_info[0] + \"'\");\n                    break;\n            }\n            if (next_info.length > 2) {\n                console.log(\"file=\" + next_info[2]);\n                return next_info[2];\n            }\n            else\n                return null;\n        };\n        Scenario.prototype.run = function () {\n            var g, i;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this.sub_scenario = [];\n                        this.states = [];\n                        this.histories = [];\n                        this.count = 0;\n                        g = this.loop(this._config[\"scenario\"]);\n                        i = g.next();\n                        _a.label = 1;\n                    case 1:\n                        if (!!i.done) return [3, 4];\n                        return [4, i.value];\n                    case 2:\n                        _a.sent();\n                        _a.label = 3;\n                    case 3:\n                        i = g.next();\n                        return [3, 1];\n                    case 4: return [2];\n                }\n            });\n        };\n        Scenario.prototype.force = function (states) {\n            while (this.sub_scenario.length > states.length) {\n                this.sub_scenario.pop();\n                this.histories.pop();\n            }\n            this.states = states;\n            this.histories.push(states);\n        };\n        Scenario.prototype.loop = function (current_scenario) {\n            var head, scenario, _i, scenario_2, cs, action, content, _a, resources, sounds, images, i, resources, filename_1, options, next, filename;\n            if (current_scenario === void 0) { current_scenario = null; }\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        if (false) {}\n                        this.count++;\n                        console.log(\"\\nTrial \" + this.count + \":\");\n                        if (!current_scenario) {\n                            if (this.states.length > 0 && this.sub_scenario.length > 0)\n                                current_scenario = this.sub_scenario[this.sub_scenario.length - 1][this.states[this.states.length - 1]];\n                            else\n                                return [2];\n                        }\n                        if (this.states.length > 0)\n                            console.log(\"STATE[\" + this.states.length + \"]=\" + this.states[this.states.length - 1]);\n                        head = current_scenario[0];\n                        scenario = [];\n                        if (typeof (head) == 'string') {\n                            scenario = [current_scenario];\n                        }\n                        else if (typeof (head) == 'object') {\n                            scenario = current_scenario.slice(0, current_scenario.length - 1);\n                        }\n                        _i = 0, scenario_2 = scenario;\n                        _b.label = 1;\n                    case 1:\n                        if (!(_i < scenario_2.length)) return [3, 15];\n                        cs = scenario_2[_i];\n                        action = cs[0];\n                        console.log(\"ACTIONS=\" + action);\n                        _a = action;\n                        switch (_a) {\n                            case Scenario.SubScenario: return [3, 2];\n                            case Scenario.PlayAll: return [3, 3];\n                            case Scenario.PlayOne: return [3, 8];\n                            case Scenario.Ask: return [3, 10];\n                            case Scenario.Select: return [3, 12];\n                            case Scenario.Nop: return [3, 13];\n                        }\n                        return [3, 14];\n                    case 2:\n                        content = cs[1];\n                        console.log(\"Push SubScenario \" + content);\n                        this.sub_scenario.push(content);\n                        this.states.push(null);\n                        this.histories.push([]);\n                        return [3, 14];\n                    case 3:\n                        content = cs[1];\n                        resources = this.list_files(null, content);\n                        sounds = resources[0], images = resources[1];\n                        i = 0;\n                        _b.label = 4;\n                    case 4:\n                        if (!(i < sounds.length)) return [3, 7];\n                        return [4, (new Scene(sounds[i], this.get_image_path(images, i)))];\n                    case 5:\n                        _b.sent();\n                        _b.label = 6;\n                    case 6:\n                        i++;\n                        return [3, 4];\n                    case 7: return [3, 14];\n                    case 8:\n                        content = cs[1];\n                        resources = this.select_action_rand(null, content);\n                        filename_1 = resources[1];\n                        return [4, (new Scene(filename_1[0], filename_1[1]))];\n                    case 9:\n                        _b.sent();\n                        return [3, 14];\n                    case 10:\n                        options = cs[1];\n                        console.log(\"  options=\" + options);\n                        return [4, (new Ask(options))];\n                    case 11:\n                        _b.sent();\n                        return [3, 14];\n                    case 12:\n                        {\n                            content = cs[1];\n                        }\n                        return [3, 14];\n                    case 13: return [3, 14];\n                    case 14:\n                        _i++;\n                        return [3, 1];\n                    case 15:\n                        next = current_scenario[current_scenario.length - 1];\n                        filename = this.transit_to_next(next);\n                        if (!filename) return [3, 17];\n                        return [4, (new Scene(filename[0], filename[1]))];\n                    case 16:\n                        _b.sent();\n                        _b.label = 17;\n                    case 17:\n                        current_scenario = null;\n                        return [3, 0];\n                    case 18:\n                        ;\n                        return [2];\n                }\n            });\n        };\n        Scenario.PlayAll = \"play-all\";\n        Scenario.PlayOne = \"play-one\";\n        Scenario.Select = \"select\";\n        Scenario.Ask = \"ask\";\n        Scenario.Nop = \"nop\";\n        Scenario.SubScenario = \"sub-scenario\";\n        Scenario.Jump = \"jump\";\n        Scenario.Exit = \"exit\";\n        Scenario.Dice = \"dice\";\n        Scenario.DiceWithMode = \"dice-with-mode\";\n        Scenario.DiceWith = \"dice-with\";\n        Scenario.JumpBy = \"jump-by\";\n        return Scenario;\n    }());\n    scenario_1.Scenario = Scenario;\n})(scenario = exports.scenario || (exports.scenario = {}));\n\n\n//# sourceURL=webpack:///./src/main/scenario/scenario.ts?");

/***/ }),

/***/ "./src/main/soundnovel.ts":
/*!********************************!*\
  !*** ./src/main/soundnovel.ts ***!
  \********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar path = __webpack_require__(/*! path */ \"path\");\nvar fs = __webpack_require__(/*! fs */ \"fs\");\nvar yaml = __webpack_require__(/*! js-yaml */ \"js-yaml\");\nvar scenario_1 = __webpack_require__(/*! ./scenario/scenario */ \"./src/main/scenario/scenario.ts\");\nvar electron = __webpack_require__(/*! electron */ \"electron\");\nvar ScenarioPlayer = (function () {\n    function ScenarioPlayer() {\n    }\n    ScenarioPlayer.prototype.receive_start = function () {\n        var _this = this;\n        return new Promise(function (resolve, reject) {\n            electron.ipcMain.once(\"start\", function (event) {\n                event.reply(\"screen\", _this.scenario.config[\"screen\"][\"size\"]);\n                event.reply(\"fullscreen\", _this.screen.fullscreen);\n                resolve(event);\n            });\n        });\n    };\n    ScenarioPlayer.prototype.receive_cmds = function () {\n        return new Promise(function (resolve, reject) {\n            electron.ipcMain.once(\"command\", function (event, name) {\n                resolve(event);\n            });\n            electron.ipcMain.removeAllListeners(\"terminate\");\n            electron.ipcMain.once(\"terminate\", function (event, name) {\n                reject(event);\n            });\n        });\n    };\n    ScenarioPlayer.prototype.receive_others = function () {\n        var _this = this;\n        electron.ipcMain.on(\"set-variable\", function (event, name, value) {\n            _this.scenario.variables[name] = value;\n        });\n        electron.ipcMain.on(\"fullscreen\", function (event, value) {\n            if (value) {\n                _this.screen.setResizable(true);\n                _this.screen.setFullScreen(value);\n            }\n            else {\n                _this.screen.setFullScreen(value);\n                _this.screen.setResizable(false);\n                _this.screen.setMenuBarVisibility(false);\n            }\n            event.reply(\"fullscreen\", value);\n        });\n    };\n    ScenarioPlayer.prototype.post_cmd = function (event, command) {\n        if (command instanceof scenario_1.scenario.Scene) {\n            var scene = command;\n            event.reply(\"command\", [\"scene\", scene.sound, scene.image]);\n        }\n        else if (command instanceof scenario_1.scenario.Ask) {\n            var ask = command;\n            event.reply(\"command\", [\"ask\", ask.options]);\n        }\n        else {\n            event.reply(\"command\", command);\n        }\n    };\n    ScenarioPlayer.prototype.exec_cmd = function (event, command) {\n        var result = this.receive_cmds();\n        this.post_cmd(event, command);\n        return result;\n    };\n    ScenarioPlayer.prototype.title = function (event) {\n        return __awaiter(this, void 0, void 0, function () {\n            var title_img, options, scene, ask;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        title_img = this.scenario.get_image_path(this.scenario.config[\"image_map\"][\"title\"], 0);\n                        if (!this.scenario.config[\"modes\"]) return [3, 4];\n                        options = {\n                            \"location\": this.scenario.config[\"screen\"][\"menu_location\"],\n                            \"candidates\": this.scenario.config[\"modes\"],\n                            \"variable\": \"mode\"\n                        };\n                        options[\"color\"] = this.scenario.config[\"screen\"][\"menu_color\"];\n                        options[\"layout\"] = this.scenario.config[\"screen\"][\"menu_layout\"];\n                        options[\"size\"] = this.scenario.config[\"screen\"][\"menu_size\"];\n                        scene = new scenario_1.scenario.Scene(null, title_img);\n                        ask = new scenario_1.scenario.Ask(options);\n                        return [4, this.exec_cmd(event, [\"title\", this.window_title])];\n                    case 1:\n                        event = _a.sent();\n                        return [4, this.exec_cmd(event, scene)];\n                    case 2:\n                        event = _a.sent();\n                        console.log(\"title scene done.\");\n                        return [4, this.exec_cmd(event, ask)];\n                    case 3:\n                        event = _a.sent();\n                        return [2, event];\n                    case 4: return [2, null];\n                }\n            });\n        });\n    };\n    ScenarioPlayer.prototype.execute_scenario = function (event) {\n        return __awaiter(this, void 0, void 0, function () {\n            var gen, i, command, reason_1;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        gen = this.scenario.run();\n                        i = gen.next();\n                        _a.label = 1;\n                    case 1:\n                        if (!!i.done) return [3, 6];\n                        command = i.value;\n                        _a.label = 2;\n                    case 2:\n                        _a.trys.push([2, 4, , 5]);\n                        return [4, this.exec_cmd(event, command)];\n                    case 3:\n                        event = _a.sent();\n                        return [3, 5];\n                    case 4:\n                        reason_1 = _a.sent();\n                        console.log(\"rejected. event:\" + reason_1);\n                        this.scenario.force(Array.from(this.scenario.config[\"failure\"] || []));\n                        gen = this.scenario.loop(null);\n                        event = reason_1;\n                        return [3, 5];\n                    case 5:\n                        i = gen.next();\n                        return [3, 1];\n                    case 6:\n                        console.log(\"Terminate scenario.\");\n                        return [2, event];\n                }\n            });\n        });\n    };\n    ScenarioPlayer.prototype.run = function () {\n        var _this = this;\n        var filename = process.argv[process.argv.length - 1];\n        var root_path = path.dirname(filename);\n        console.log(\"Reading config (\" + filename + \")\");\n        var yamlText = fs.readFileSync(filename, 'utf8');\n        var config = yaml.safeLoad(yamlText);\n        this.scenario = new scenario_1.scenario.Scenario(root_path, config);\n        var size = config[\"screen\"][\"size\"];\n        var w = size[0], h = size[1];\n        var point = electron.screen.getCursorScreenPoint();\n        var display = electron.screen.getDisplayNearestPoint(point);\n        this.screen = new electron.BrowserWindow({\n            x: display.bounds.x + (display.bounds.width - w) / 2,\n            y: display.bounds.y + (display.bounds.height - h) / 2,\n            width: w,\n            height: h,\n            webPreferences: {\n                nodeIntegration: true\n            }\n        });\n        this.screen.setMenuBarVisibility(false);\n        this.screen.setResizable(false);\n        this.screen.loadFile('./index.html');\n        this.window_title = path.basename(path.dirname(filename));\n        this.receive_others();\n        var doit = function () { return __awaiter(_this, void 0, void 0, function () {\n            var event;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4, this.receive_start()];\n                    case 1:\n                        event = _a.sent();\n                        _a.label = 2;\n                    case 2:\n                        if (false) {}\n                        return [4, this.title(event)];\n                    case 3:\n                        event = _a.sent();\n                        return [4, this.execute_scenario(event)];\n                    case 4:\n                        event = _a.sent();\n                        return [3, 2];\n                    case 5: return [2];\n                }\n            });\n        }); };\n        doit();\n    };\n    return ScenarioPlayer;\n}());\nvar scenario_test = function () {\n    var filename = process.argv[process.argv.length - 1];\n    var root_path = path.dirname(filename);\n    console.log(\"Reading config (\" + filename + \")\");\n    var yamlText = fs.readFileSync(filename, 'utf8');\n    var config = yaml.safeLoad(yamlText);\n    var sc = new scenario_1.scenario.Scenario(root_path, config);\n    sc.variables[\"mode\"] = sc.config[\"modes\"][sc.config[\"modes\"].length - 1];\n    for (var k in sc.config) {\n        console.log(\" config.\" + k + \": \" + sc.config[k]);\n    }\n    var g = sc.run();\n    for (var i = g.next(); !i.done; i = g.next()) {\n        var command = i.value;\n        if (command instanceof scenario_1.scenario.Scene) {\n            var scene = command;\n            console.log(\"Scene : sounds=\" + scene.sound + \", images=\" + scene.image);\n        }\n        else if (command instanceof scenario_1.scenario.Ask) {\n            var ask = command;\n            console.log(\"Ask : options=\" + ask.options);\n        }\n    }\n};\nvar gui = new ScenarioPlayer();\nelectron.app.on('ready', function () { gui.run(); });\n\n\n//# sourceURL=webpack:///./src/main/soundnovel.ts?");

/***/ }),

/***/ "electron":
/*!***************************!*\
  !*** external "electron" ***!
  \***************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"electron\");\n\n//# sourceURL=webpack:///external_%22electron%22?");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"fs\");\n\n//# sourceURL=webpack:///external_%22fs%22?");

/***/ }),

/***/ "glob":
/*!***********************!*\
  !*** external "glob" ***!
  \***********************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"glob\");\n\n//# sourceURL=webpack:///external_%22glob%22?");

/***/ }),

/***/ "js-yaml":
/*!**************************!*\
  !*** external "js-yaml" ***!
  \**************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"js-yaml\");\n\n//# sourceURL=webpack:///external_%22js-yaml%22?");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"path\");\n\n//# sourceURL=webpack:///external_%22path%22?");

/***/ })

/******/ });